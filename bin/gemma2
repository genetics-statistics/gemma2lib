#!/usr/bin/env python3

import sys
import pprint
import click # command line parsing

from os.path import dirname
from toolz.functoolz import pipe
from itertools import chain

BASEDIR=str.strip(pipe(__file__,dirname,dirname)) or "."
VERSION=open(BASEDIR+"/VERSION").read()

print("GEMMA2",VERSION,"by Pjotr Prins, Xiang Zhou and others")

print("""GEMMA2 is a new generation GEMMA that aims to incorporate
state-of-the-art GWA analysis.

GEMMA2 has its own command line parameters. Other parameters are
passed on to GEMMA (version 1).
""")

second = ["gwa"]

# pp = pprint.PrettyPrinter(indent=4)
# print(sys.argv)

split_on = ["%", "'=>'"]

def gemma1():
    """At this stage a simple pass-through"""
    click.echo("** Call gemma1")

@click.group(invoke_without_command=True)
@click.option('--debug/--no-debug', default=False)
@click.pass_context
def gemma2(ctx,debug):
    if not ctx.invoked_subcommand:
        gemma1()
    ctx.ensure_object(dict)
    ctx.obj['DEBUG'] = debug
    click.echo('1 Debug is %s' % (ctx.obj['DEBUG'] and 'on' or 'off'))

@gemma2.command()
@click.pass_context
def filter(ctx):
    click.echo('** Filter data')

@gemma2.command()
@click.pass_context
def grm(ctx):
    click.echo('** Kinship/Genetic Relationship Matrix (GRM) command')
    click.echo('2 Debug is %s' % (ctx.obj['DEBUG'] and 'on' or 'off'))
    if second:
        gemma2(second)

@gemma2.command()
@click.option('--port', default=8000)
@click.pass_context
def gwa(ctx,port):
    click.echo('** Genome-wide Association (GWA)')
    click.echo('3 Debug is %s' % (ctx.obj['DEBUG'] and 'on' or 'off'))
    click.echo(port)

gemma2.add_command(filter)
gemma2.add_command(grm)
gemma2.add_command(gwa)

gemma2()
